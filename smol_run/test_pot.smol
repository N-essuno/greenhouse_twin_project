main
    Int lengthPots = 0;
    Int lengthShelves = 0;
    Int i = 0;

    String config = "config_local.yml";

    AssetModel assetModel = new AssetModel();
    List<Pot> pots = assetModel.getPots(config);
    List<Shelf> shelves = assetModel.getShelves(config);

    lengthPots = pots.length();
    lengthShelves = shelves.length();

    print("-------------------------------- Pots from asset model");
    while i < lengthPots do
        Pot pot = pots.get(i);
        print("shelfFloor: ");
        print(pot.shelfFloor);
        print(" groupPosition: ");
        print(pot.groupPosition);
        print(" potPosition: ");
        print(pot.potPosition);
        print(" moisture: ");
        Moisture moisture = pot.getMoisture();
        print(moisture);
        i = i+1;
    end
    

    print("-------------------------------- Shelves from asset model");
    i = 0;
    while i < lengthShelves do
        Shelf shelf = shelves.get(i);
        print("shelfFloor: ");
        print(shelf.shelfFloor);
        i = i+1;
    end

    breakpoint;
end

/**
* Represents a physical Pot. Should be retrieved from the asset model via AssetModel.getPots()
* Each pot in the is associated with a moisture sensor.
*/
class Pot(Int shelfFloor, String groupPosition, String potPosition)
    models "rdf:type ast:Pot.";

    // Return last moisture detection for the pot
    Double getMoisture()
        // TODO should parameterize query based on shelfFloor, groupPosition, potPosition
        Double moisture = 0.0;
        List<Double> influxReturn = null;
        
        // uses list because influx queries return lists
        influxReturn = access(
            "from(bucket: \"greenhouse_test\")
                |> range(start: -30d)
                |> filter(fn: (r) => r[\"_measurement\"] == \"ast:pot\")
                |> filter(fn: (r) => r[\"_field\"] == \"moisture\")
                |> filter(fn: (r) => r[\"group_position\"] == \"right\")
                |> filter(fn: (r) => r[\"pot_position\"] == \"left\")
                |> filter(fn: (r) => r[\"shelf_floor\"] == \"1\")
                |> keep(columns: [\"_value\"])
                |> last()",
        INFLUXDB("config_local.yml"));
        // get first value of list (list contains just one value)
        moisture = influxReturn.get(0);
        return moisture;
    end
end

/**
* Represents a physical Shelf. Should be retrieved from the asset model via AssetModel.getShelves()
* Each Shelf is associated with a humidity and a temperature sensors.
*/
class Shelf(Int shelfFloor)
    models "rdf:type ast:Shelf.";

    // Return last humidity detection for the shelf
    Double getHumidity()
        Double humidity = 0.0;
        // get humidity from influx
        return humidity;
    end

    // Return last temperature detection for the shelf
    Double getTemperature()
        Double temperature = 0.0;
        // get temperature from influx
        return temperature;
    end
end


/**
* Retrieves data from the asset model and convert it to SMOL objects
*/
class AssetModel()
    // get pot instances from the asset model
    List<Pot> getPots()
        List<Pot> pots = construct("
        PREFIX ast: <http://www.semanticweb.org/gianl/ontologies/2023/1/sirius-greenhouse#>
        SELECT ?shelfFloor ?groupPosition ?potPosition
        WHERE {
            ?pot rdf:type ast:Pot ;
                ast:hasShelfFloor ?shelfFloor ;
                ast:hasGroupPosition ?groupPosition ;
                ast:hasPotPosition ?potPosition .
        }");
        return pots;
    end

    // get shelf instances from the asset model
    List<Shelf> getShelves()
        List<Shelf> shelves = construct("
            PREFIX ast: <http://www.semanticweb.org/gianl/ontologies/2023/1/sirius-greenhouse#>
            SELECT ?shelfFloor
            WHERE {
                ?shelf rdf:type ast:Shelf ;
                    ast:hasShelfFloor ?shelfFloor .
            }
        ");
        return shelves;
    end
end

class Utils(String config)

end